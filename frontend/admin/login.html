<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî FlyTaxi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body class="page page--centered">
<div class="login-box">
    <h1 class="login-title">–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
    <p class="login-subtitle">–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤—ã–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.</p>

    <form id="adminLoginForm" class="login-form">
        <div class="input-group">
            <input
                    type="text"
                    name="login"
                    class="input"
                    placeholder="–õ–æ–≥–∏–Ω"
                    required
            />
        </div>

        <div class="input-group">
            <input
                    type="password"
                    name="password"
                    class="input"
                    placeholder="–ü–∞—Ä–æ–ª—å"
                    required
            />
        </div>

        <button type="submit" class="btn btn--admin" style="width:100%;">
            –í–æ–π—Ç–∏ üëë
        </button>

        <div id="adminLoginMessage" class="login-info"></div>
    </form>

    <div class="login-links">
        <a class="login-back" href="/">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<script>
    const form = document.getElementById("adminLoginForm");
    const message = document.getElementById("adminLoginMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const login = form.login.value.trim();
      const password = form.password.value;

      message.textContent = "–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ...";
      message.style.color = "#e5e7eb";

      try {
        const res = await fetch("/api/admin/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ login, password })
        });

        const json = await res.json().catch(() => ({}));

        if (!res.ok) {
          message.textContent = json.error || "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
          message.style.color = "#ef4444";
          return;
        }

        message.textContent = "–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...";
        message.style.color = "#22c55e";

        // –ø–æ–∫–∞ –±–µ–∑ –Ω–∞—Å—Ç–æ—è—â–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∞–¥–º–∏–Ω–∫—É
        setTimeout(() => {
          window.location.href = "/admin/";
        }, 800);
      } catch (err) {
        console.error(err);
        message.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ";
        message.style.color = "#ef4444";
      }
    });
</script>
</body>
</html>
