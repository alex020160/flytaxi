<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Регистрация водителя — FlyTaxi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body class="page driver-register-page">
<div class="login-box">
    <h1 class="login-title">Регистрация водителя</h1>

    <form id="driverRegisterForm" class="login-form">
        <!-- Личные данные -->
        <input
                type="text"
                id="firstName"
                class="input"
                placeholder="Имя"
                autocomplete="given-name"
                required
        />
        <input
                type="text"
                id="lastName"
                class="input"
                placeholder="Фамилия"
                autocomplete="family-name"
                required
        />
        <input
                type="text"
                id="middleName"
                class="input"
                placeholder="Отчество"
                autocomplete="additional-name"
        />

        <!-- Контакты и пароль -->
        <input
                type="email"
                id="email"
                class="input"
                placeholder="Электронная почта"
                autocomplete="email"
                required
        />
        <input
                type="tel"
                id="phone"
                class="input"
                placeholder="Номер телефона"
                autocomplete="tel"
                required
        />
        <input
                type="password"
                id="password"
                class="input"
                placeholder="Пароль (мин. 6 символов)"
                required
        />

        <!-- Данные автомобиля -->
        <input
                type="text"
                id="carMake"
                class="input"
                placeholder="Марка авто"
                required
        />
        <input
                type="text"
                id="carModel"
                class="input"
                placeholder="Модель авто"
                required
        />
        <input
                type="text"
                id="carColor"
                class="input"
                placeholder="Цвет авто"
                required
        />
        <input
                type="text"
                id="carPlate"
                class="input"
                placeholder="Гос. номер"
                required
        />
        <input
                type="text"
                id="driverLicense"
                class="input"
                placeholder="Номер водительского удостоверения"
                required
        />
        <input
                type="date"
                id="licenseExpires"
                class="input"
                placeholder="ДД.ММ.ГГГГ"
                required
        />
        <input
                type="number"
                id="experienceYears"
                class="input"
                placeholder="Стаж (лет)"
                min="0"
                required
        />

        <button type="submit" class="btn btn--driver">Зарегистрироваться</button>
    </form>

    <div id="driverRegisterInfo" class="login-info"></div>

    <a href="/driver/login.html" class="login-back">← Уже зарегистрирован</a>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form   = document.getElementById("driverRegisterForm");
        const infoEl = document.getElementById("driverRegisterInfo");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            infoEl.style.color = "#e5e7eb";
            infoEl.textContent = "Отправляем данные...";

            const payload = {
                first_name:        document.getElementById("firstName").value.trim(),
                last_name:         document.getElementById("lastName").value.trim(),
                middle_name:       document.getElementById("middleName").value.trim(),
                email:             document.getElementById("email").value.trim(),
                phone:             document.getElementById("phone").value.trim(),
                password:          document.getElementById("password").value,
                car_make:          document.getElementById("carMake").value.trim(),
                car_model:         document.getElementById("carModel").value.trim(),
                car_color:         document.getElementById("carColor").value.trim(),
                car_plate_number:  document.getElementById("carPlate").value.trim(),
                driver_license_num:document.getElementById("driverLicense").value.trim(),
                license_expires_at:document.getElementById("licenseExpires").value,
                experience_years:  Number(document.getElementById("experienceYears").value || 0),
            };

            try {
                const res = await fetch("/api/auth/driver/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload),
                });

                const json = await res.json().catch(() => ({}));

                if (!res.ok) {
                    infoEl.style.color = "#f87171";
                    infoEl.textContent = json.error || "Не удалось зарегистрировать водителя";
                    return;
                }

                infoEl.style.color = "#22c55e";
                infoEl.textContent = json.message || "Регистрация отправлена! После подтверждения вы сможете войти.";
                form.reset();
            } catch (err) {
                console.error(err);
                infoEl.style.color = "#f87171";
                infoEl.textContent = "Ошибка сети, попробуйте ещё раз";
            }
        });
    });
</script>
</body>
</html>
