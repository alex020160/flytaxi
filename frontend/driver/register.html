<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–æ–¥–∏—Ç–µ–ª—è ‚Äî FlyTaxi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body class="page page--centered">
<div class="login-box">
    <h1 class="login-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–≤–æ–¥–∏—Ç–µ–ª—å)</h1>

    <form id="driverRegisterForm" class="login-form">
        <!-- –§–ò–û -->
        <div class="input-group">
            <input class="input" name="first_name" placeholder="–ò–º—è" required />
        </div>
        <div class="input-group">
            <input class="input" name="last_name" placeholder="–§–∞–º–∏–ª–∏—è" required />
        </div>
        <div class="input-group">
            <input class="input" name="middle_name" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ" />
        </div>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
        <div class="input-group">
            <input class="input" type="email" name="email" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞" required />
        </div>
        <div class="input-group">
            <input class="input" name="phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" required />
        </div>
        <div class="input-group">
            <input class="input" type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 6 —Å–∏–º–≤–æ–ª–æ–≤)" required />
        </div>

        <!-- –ú–∞—à–∏–Ω–∞ -->
        <div class="input-group">
            <input class="input" name="car_make" placeholder="–ú–∞—Ä–∫–∞ –∞–≤—Ç–æ" required />
        </div>
        <div class="input-group">
            <input class="input" name="car_model" placeholder="–ú–æ–¥–µ–ª—å –∞–≤—Ç–æ" required />
        </div>
        <div class="input-group">
            <input class="input" name="car_color" placeholder="–¶–≤–µ—Ç –∞–≤—Ç–æ" required />
        </div>
        <div class="input-group">
            <input class="input" name="car_plate_number" placeholder="–ì–æ—Å. –Ω–æ–º–µ—Ä" required />
        </div>

        <!-- –í–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ -->
        <div class="input-group">
            <input class="input" name="driver_license_num" placeholder="–ù–æ–º–µ—Ä –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è" required />
        </div>
        <div class="input-group">
            <!-- –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç DD.MM.YYYY, –Ω–æ value –±—É–¥–µ—Ç YYYY-MM-DD -->
            <input class="input" type="date" name="license_expires_at" required />
        </div>
        <div class="input-group">
            <input class="input" type="number" name="experience_years" min="0" placeholder="–°—Ç–∞–∂ (–ª–µ—Ç)" required />
        </div>

        <button type="submit" class="btn btn--driver" style="width: 100%;">
            –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è üöï
        </button>

        <div id="driverRegisterMessage" class="login-info"></div>
    </form>

    <div class="login-links">
        <a class="login-back" href="/driver/login.html">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏</a>
        <a class="login-back" href="/">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<!-- –í–ê–ñ–ù–û: —Å–∫—Ä–∏–ø—Ç –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ body -->
<script>
    console.log("driver register script loaded");

    document.addEventListener("DOMContentLoaded", () => {
      console.log("DOMContentLoaded fired for driver/register");

      const form = document.getElementById("driverRegisterForm");
      if (!form) {
        console.error("driverRegisterForm not found!");
        return;
      }
      const message = document.getElementById("driverRegisterMessage");
      const submitBtn = form.querySelector("button[type='submit']");

      console.log("driverRegisterForm found, attaching submit handler");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        console.log("driverRegisterForm submit");

        const data = {
          first_name: form.first_name.value.trim(),
          last_name: form.last_name.value.trim(),
          middle_name: form.middle_name.value.trim(),
          email: form.email.value.trim(),
          phone: form.phone.value.trim(),
          password: form.password.value,
          car_make: form.car_make.value.trim(),
          car_model: form.car_model.value.trim(),
          car_color: form.car_color.value.trim(),
          car_plate_number: form.car_plate_number.value.trim(),
          driver_license_num: form.driver_license_num.value.trim(),
          license_expires_at: form.license_expires_at.value,   // YYYY-MM-DD
          experience_years: Number(form.experience_years.value),
        };

        console.log("driver register data:", data);

        submitBtn.disabled = true;
        message.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞...";
        message.style.color = "#e5e7eb";

        try {
          const res = await fetch("/api/auth/driver/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          const json = await res.json().catch(() => ({}));
          console.log("driver/register response:", json);

          if (!res.ok) {
            message.textContent = json.error || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–¥–∏—Ç–µ–ª—è";
            message.style.color = "#ef4444";
            return;
          }

          message.textContent =
            json.message || "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ–π—Ç–∏.";
          message.style.color = "#22c55e";

          form.reset();
        } catch (err) {
          console.error(err);
          message.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏";
          message.style.color = "#ef4444";
        } finally {
          submitBtn.disabled = false;
        }
      });
    });
</script>
</body>
</html>
