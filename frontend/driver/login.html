<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–í—Ö–æ–¥ ‚Äî FlyTaxi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body class="page page--centered">

<div class="login-box">
    <h1 class="login-title">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>

    <form id="loginForm" class="login-form">
        <input class="input" type="text" name="identifier" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ Email" required>
        <input class="input" type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
        <button class="btn btn--driver" type="submit">–í–æ–π—Ç–∏ üöï</button>
    </form>

    <p class="login-info" id="loginMessage"></p>

    <div class="login-links">
        <a class="login-back" href="register.html">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
        <a class="login-back" href="forgot-password.html">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
        <a class="login-back" href="../index.html">‚Üê –ù–∞–∑–∞–¥ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>

<script>
    const form = document.getElementById("loginForm");
    const message = document.getElementById("loginMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        identifier: form.identifier.value,
        password: form.password.value,
      };

      message.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞...";
      message.style.color = "#e5e7eb";

      try {
        const res = await fetch("/api/auth/login", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(data)
        });

        const json = await res.json();

        if (!res.ok) {
            let msg = json.error;

            if (msg === "invalid credentials") {
                msg = "–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å";
               }

            message.textContent = msg || "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏";
            message.style.color = "#ef4444";
            return;
        }

        message.textContent = "–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!";
        message.style.color = "#22c55e";

        // TODO: redirect –Ω–∞ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è
        // window.location.href = "/driver/dashboard.html";

      } catch (err) {
        message.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏";
        message.style.color = "#ef4444";
      }
    });
</script>

</body>
</html>
