<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Восстановление пароля — FlyTaxi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="/assets/css/fonts.css">
    <link rel="stylesheet" href="/assets/css/main.css">
</head>
<body class="page page--centered">

<div class="login-box">
    <h1 class="login-title">Восстановление пароля</h1>

    <form id="forgotForm" class="login-form">
        <input class="input" type="text" name="identifier" placeholder="Телефон или Email" required>
        <button class="btn btn--driver" type="submit">Сбросить пароль</button>
    </form>

    <p class="login-info" id="forgotMessage"></p>

    <div class="login-links">
        <a class="login-back" href="login.html">← Назад к входу</a>
        <a class="login-back" href="../index.html">← На главную</a>
    </div>
</div>

<script>
    const form = document.getElementById("forgotForm");
    const message = document.getElementById("forgotMessage");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const identifier = form.identifier.value;

      message.textContent = "Отправляем письмо...";
      message.style.color = "#e5e7eb";

      try {
        const res = await fetch("/api/auth/forgot-password", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ identifier })
        });

        const json = await res.json().catch(() => ({}));

        if (!res.ok) {
          message.textContent = json.error || "Ошибка при запросе сброса пароля";
          message.style.color = "#ef4444";
          return;
        }

        message.textContent = "Если такой пользователь существует, на его email отправлен код.";
        message.style.color = "#22c55e";

        // ⬇️ ПЕРЕХОД НА СТРАНИЦУ УСТАНОВКИ ПАРОЛЯ
        setTimeout(() => {
          const email = encodeURIComponent(identifier);
          window.location.href = "/driver/reset-password.html?email=" + email;
        }, 1500);

      } catch (err) {
        message.textContent = "Ошибка сети";
        message.style.color = "#ef4444";
      }
    });
</script>


</body>
</html>
